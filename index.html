<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tes Kepribadian Big Five (OCEAN) - Versi Lengkap</title>
    <!-- Memuat Tailwind CSS untuk styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Memuat Chart.js untuk membuat grafik radar -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Menggunakan Font Inter dari Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; transition: background-color 0.3s; }
        .skala-container input:checked + label { background-color: #3b82f6; color: white; border-color: #3b82f6; }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

    <div class="container mx-auto max-w-4xl p-4 sm:p-8">
        <!-- Header Utama -->
        <header id="main-header" class="text-center mb-8">
             <h1 class="text-3xl sm:text-4xl font-bold text-slate-900">Tes Kepribadian Big Five (OCEAN)</h1>
             <p class="mt-2 text-slate-600">Alat Bantu untuk Rekrutmen & Pengembangan Diri</p>
        </header>

        <!-- Tampilan Awal (Pemilihan Mode) -->
        <div id="mode-selection" class="bg-white p-8 rounded-xl shadow-md text-center fade-in">
            <h2 class="text-2xl font-bold mb-6">Pilih Mode Penggunaan</h2>
            <div class="space-y-4">
                <button id="start-test-btn" class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:bg-blue-700 transition-colors duration-300">
                    Mulai Sebagai Kandidat
                </button>
                <button id="view-results-btn" class="w-full bg-slate-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:bg-slate-700 transition-colors duration-300">
                    Lihat Hasil Rekrutmen
                </button>
            </div>
        </div>

        <!-- Tampilan Input Nama Kandidat -->
        <div id="name-input-container" class="hidden bg-white p-8 rounded-xl shadow-md text-center fade-in">
            <h2 class="text-xl font-bold mb-4">Informasi Kandidat</h2>
            <p class="text-slate-600 mb-6">Silakan masukkan nama lengkap atau email Anda untuk memulai.</p>
            <input type="text" id="candidate-name" placeholder="Contoh: Budi Santoso atau budi@email.com" class="w-full max-w-md mx-auto p-3 border border-slate-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            <div id="name-error" class="text-red-500 text-sm mt-2 h-5"></div>
            <button id="begin-test-btn" class="mt-4 w-full max-w-md mx-auto bg-blue-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:bg-blue-700 transition-colors duration-300">
                Mulai Tes
            </button>
        </div>

        <!-- Bagian Kuesioner (awalnya tersembunyi) -->
        <main id="kuesioner-container" class="hidden bg-white p-6 sm:p-8 rounded-xl shadow-md fade-in">
            <!-- Progress Bar -->
            <div class="mb-6">
                <div class="flex justify-between mb-1">
                    <span class="text-base font-medium text-blue-700">Progress</span>
                    <span id="progress-text" class="text-sm font-medium text-blue-700">Pertanyaan 1 dari 50</span>
                </div>
                <div class="w-full bg-slate-200 rounded-full h-2.5">
                    <div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full transition-all duration-500 ease-out" style="width: 2%"></div>
                </div>
            </div>

            <!-- Tempat untuk Pertanyaan (Satu per satu) -->
            <div id="question-display" class="my-8"></div>

            <!-- Tombol Navigasi -->
            <div id="navigation-buttons" class="flex justify-between items-center mt-10">
                <button id="prev-btn" class="bg-slate-500 text-white font-bold py-3 px-8 rounded-lg shadow-md hover:bg-slate-600 transition-colors duration-300 disabled:bg-slate-300 disabled:cursor-not-allowed">
                    Sebelumnya
                </button>
                <button id="next-btn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg shadow-md hover:bg-blue-700 transition-colors duration-300">
                    Berikutnya
                </button>
            </div>
             <div id="error-message" class="text-center text-red-500 font-medium mt-4 h-6"></div>
        </main>

        <!-- Bagian Hasil Individual (awalnya tersembunyi) -->
        <section id="hasil-container" class="hidden">
            <div class="bg-white p-6 sm:p-8 rounded-xl shadow-md text-center fade-in">
                <h2 class="text-2xl sm:text-3xl font-bold text-slate-900 mb-2">Tes Selesai! Terima Kasih.</h2>
                <p class="text-slate-600 mb-8">Hasil Anda telah direkam. Berikut adalah ringkasan profil kepribadian Anda.</p>
                <div class="w-full max-w-lg mx-auto mb-10">
                    <canvas id="grafik-hasil"></canvas>
                </div>
                <div id="penjelasan-hasil" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 text-left"></div>
                 <div class="mt-10">
                    <button onclick="window.location.reload()" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg shadow-lg hover:bg-blue-700 transition-colors duration-300">
                        Kembali ke Halaman Awal
                    </button>
                </div>
            </div>
        </section>

        <!-- Bagian Hasil Rekrutmen (awalnya tersembunyi) -->
        <section id="recruiter-container" class="hidden">
             <div class="bg-white p-6 sm:p-8 rounded-xl shadow-md fade-in">
                <h2 class="text-2xl sm:text-3xl font-bold text-slate-900 mb-6 text-center">Hasil Tes Semua Kandidat</h2>
                <div id="results-table-container" class="overflow-x-auto">
                    <!-- Tabel hasil akan dimasukkan di sini -->
                </div>
                <div class="mt-8 text-center">
                     <button onclick="window.location.reload()" class="bg-slate-600 text-white font-bold py-3 px-8 rounded-lg shadow-lg hover:bg-slate-700 transition-colors duration-300">
                        Kembali ke Halaman Awal
                    </button>
                </div>
             </div>
        </section>

    </div>

    <!-- Overlay untuk Error Konfigurasi Firebase -->
    <div id="firebase-error-overlay" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg shadow-xl p-8 max-w-lg text-center fade-in">
            <h2 class="text-2xl font-bold text-red-600 mb-4">Kesalahan Konfigurasi Firebase</h2>
            <p class="text-slate-700 mb-6">Layanan Autentikasi Anonim untuk proyek ini belum diaktifkan. Aplikasi tidak dapat terhubung ke database sebelum ini diperbaiki.</p>
            <div class="text-left bg-slate-50 p-4 rounded-md border border-slate-200">
                <h3 class="font-bold mb-2">Langkah-langkah untuk Memperbaiki:</h3>
                <ol class="list-decimal list-inside space-y-2 text-slate-600">
                    <li>Buka **Firebase Console** proyek Anda.</li>
                    <li>Pergi ke menu **Build** > **Authentication**.</li>
                    <li>Pilih tab **Sign-in method**.</li>
                    <li>Klik pada **Anonymous** (Anonim) dari daftar penyedia.</li>
                    <li>Aktifkan (Enable) tombolnya lalu klik **Save**.</li>
                </ol>
            </div>
            <p class="mt-6 text-sm text-slate-500">Setelah Anda mengaktifkannya, silakan muat ulang (refresh) halaman ini.</p>
        </div>
    </div>


    <!-- Firebase SDK -->
    <script type="module">
        // Import fungsi yang diperlukan dari Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, Timestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js";

        // --- Konfigurasi Firebase Anda ---
        const firebaseConfig = {
            apiKey: "AIzaSyB9X4NarIR047fqYEEexBBwtvaRkZWm5Aw",
            authDomain: "oceanindo-test.firebaseapp.com",
            projectId: "oceanindo-test",
            storageBucket: "oceanindo-test.appspot.com",
            messagingSenderId: "436108196304",
            appId: "1:436108196304:web:ada0a30514f712de5a61d5",
            measurementId: "G-X7GJXW4G94"
        };
        
        const appId = firebaseConfig.projectId;

        // Inisialisasi Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // Autentikasi anonim untuk keamanan dasar
        signInAnonymously(auth).catch((error) => {
            console.error("Gagal melakukan autentikasi anonim:", error);
            if (error.code === 'auth/configuration-not-found') {
                document.getElementById('firebase-error-overlay').classList.remove('hidden');
            } else {
                 alert("Terjadi kesalahan koneksi ke Firebase yang tidak terduga: " + error.message);
            }
        });

        // --- DATA APLIKASI ---
        const questions = [ { text: "Saya adalah pusat perhatian di sebuah pesta.", trait: "E", reverse: false }, { text: "Saya tidak terlalu peduli dengan orang lain.", trait: "A", reverse: true }, { text: "Saya selalu menyiapkan segala sesuatu.", trait: "C", reverse: false }, { text: "Saya jarang merasa stres.", trait: "N", reverse: true }, { text: "Saya memiliki kosakata yang kaya.", trait: "O", reverse: false }, { text: "Saya tidak banyak bicara.", trait: "E", reverse: true }, { text: "Saya tertarik pada orang lain.", trait: "A", reverse: false }, { text: "Saya sering meninggalkan barang-barang saya berantakan.", trait: "C", reverse: true }, { text: "Saya santai hampir sepanjang waktu.", trait: "N", reverse: true }, { text: "Saya kesulitan memahami ide-ide abstrak.", trait: "O", reverse: true }, { text: "Saya merasa nyaman berada di antara orang-orang.", trait: "E", reverse: false }, { text: "Saya sering menghina orang lain.", trait: "A", reverse: true }, { text: "Saya memperhatikan detail.", trait: "C", reverse: false }, { text: "Saya sering merasa khawatir tentang banyak hal.", trait: "N", reverse: false }, { text: "Saya memiliki imajinasi yang hidup.", trait: "O", reverse: false }, { text: "Saya lebih suka menyendiri.", trait: "E", reverse: true }, { text: "Saya bisa merasakan emosi orang lain.", trait: "A", reverse: false }, { text: "Saya sering membuat kekacauan.", trait: "C", reverse: true }, { text: "Saya jarang merasa sedih atau murung.", trait: "N", reverse: true }, { text: "Saya tidak tertarik pada ide-ide abstrak.", trait: "O", reverse: true }, { text: "Saya memulai percakapan.", trait: "E", reverse: false }, { text: "Saya tidak terlalu tertarik pada masalah orang lain.", trait: "A", reverse: true }, { text: "Saya langsung mengerjakan pekerjaan saya.", trait: "C", reverse: false }, { text: "Saya mudah merasa kesal.", trait: "N", reverse: false }, { text: "Saya punya ide-ide yang cemerlang.", trait: "O", reverse: false }, { text: "Saya menghindari menjadi pusat perhatian.", trait: "E", reverse: true }, { text: "Saya memiliki hati yang lembut.", trait: "A", reverse: false }, { text: "Saya sering lupa mengembalikan barang ke tempatnya.", trait: "C", reverse: true }, { text: "Saya sangat mudah emosi.", trait: "N", reverse: false }, { text: "Saya tidak memiliki imajinasi yang bagus.", trait: "O", reverse: true }, { text: "Saya banyak bicara di berbagai situasi.", trait: "E", reverse: false }, { text: "Saya benar-benar peduli pada orang lain.", trait: "A", reverse: false }, { text: "Saya suka keteraturan.", trait: "C", reverse: false }, { text: "Suasana hati saya sering berubah-ubah.", trait: "N", reverse: false }, { text: "Saya cepat memahami sesuatu.", trait: "O", reverse: false }, { text: "Saya tidak suka menarik perhatian orang ke diri saya.", trait: "E", reverse: true }, { text: "Saya meluangkan waktu untuk orang lain.", trait: "A", reverse: false }, { text: "Saya orang yang ceroboh.", trait: "C", reverse: true }, { text: "Saya sering merasa galau.", trait: "N", reverse: false }, { text: "Saya kurang kreatif.", trait: "O", reverse: true }, { text: "Saya tidak keberatan menjadi pusat perhatian.", trait: "E", reverse: false }, { text: "Saya merasakan penderitaan orang lain.", trait: "A", reverse: false }, { text: "Saya adalah orang yang teliti dan selalu rapi.", trait: "C", reverse: false }, { text: "Saya jarang merasa cemas.", trait: "N", reverse: true }, { text: "Saya pandai menggunakan kata-kata yang sulit.", trait: "O", reverse: false }, { text: "Saya tetap di latar belakang (tidak menonjol).", trait: "E", reverse: true }, { text: "Saya sering merasa tidak simpati pada orang lain.", trait: "A", reverse: true }, { text: "Saya terkadang mengabaikan tugas-tugas saya.", trait: "C", reverse: true }, { text: "Saya memiliki emosi yang stabil.", trait: "N", reverse: true }, { text: "Saya sulit membayangkan sesuatu.", trait: "O", reverse: true }];
        const descriptions = { O: { name: "Openness (Keterbukaan)", high: "Anda sangat imajinatif, kreatif, dan penuh rasa ingin tahu. Anda menikmati ide-ide baru, seni, dan pengalaman yang tidak biasa. Anda tidak takut dengan perubahan.", low: "Anda praktis, membumi, dan lebih menyukai hal-hal yang sudah dikenal dan rutin. Anda menghargai tradisi dan hal-hal yang konkret." }, C: { name: "Conscientiousness (Kehati-hatian)", high: "Anda sangat teratur, disiplin, berorientasi pada tujuan, dan dapat diandalkan. Anda seorang perencana yang baik dan sangat teliti.", low: "Anda lebih spontan, fleksibel, dan santai. Anda kurang suka dengan struktur yang kaku dan kadang bisa ceroboh atau menunda pekerjaan." }, E: { name: "Extraversion (Ekstraversi)", high: "Anda mendapatkan energi dari interaksi sosial. Anda suka keramaian, banyak bicara, antusias, dan senang menjadi pusat perhatian.", low: "Anda menghabiskan energi saat bersosialisasi dan butuh waktu sendiri untuk 'mengisi ulang'. Anda lebih pendiam, reflektif, dan lebih suka interaksi mendalam dengan sedikit orang." }, A: { name: "Agreeableness (Keramahan)", high: "Anda sangat kooperatif, penuh empati, suka menolong, dan mudah percaya. Anda cenderung menghindari konflik dan menjaga keharmonisan.", low: "Anda lebih kompetitif, analitis, dan skeptis. Anda tidak takut menyuarakan pendapat yang berbeda atau berdebat demi kebenaran." }, N: { name: "Neuroticism (Kestabilan Emosi)", high: "Anda rentan terhadap stres dan emosi negatif seperti cemas, sedih, dan marah. Anda cenderung overthinking dan mudah khawatir.", low: "Anda sangat tenang, tangguh, dan stabil secara emosional. Anda tidak mudah panik di bawah tekanan dan cepat pulih dari pengalaman negatif." } };
        
        let currentQuestionIndex = 0;
        let userAnswers = new Array(questions.length).fill(null);
        let candidateName = '';

        const modeSelection = document.getElementById('mode-selection');
        const nameInputContainer = document.getElementById('name-input-container');
        const candidateNameInput = document.getElementById('candidate-name');
        const nameError = document.getElementById('name-error');
        const beginTestBtn = document.getElementById('begin-test-btn');
        const kuesionerContainer = document.getElementById('kuesioner-container');
        const questionDisplay = document.getElementById('question-display');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const nextBtn = document.getElementById('next-btn');
        const prevBtn = document.getElementById('prev-btn');
        const errorMessage = document.getElementById('error-message');
        const hasilContainer = document.getElementById('hasil-container');
        const recruiterContainer = document.getElementById('recruiter-container');

        // Fungsi Navigasi
        document.getElementById('start-test-btn').addEventListener('click', () => { modeSelection.classList.add('hidden'); nameInputContainer.classList.remove('hidden'); });
        document.getElementById('view-results-btn').addEventListener('click', () => { modeSelection.classList.add('hidden'); fetchAndDisplayAllResults(); recruiterContainer.classList.remove('hidden'); });
        beginTestBtn.addEventListener('click', () => { if (candidateNameInput.value.trim() === '') { nameError.textContent = 'Nama tidak boleh kosong.'; return; } nameError.textContent = ''; candidateName = candidateNameInput.value.trim(); nameInputContainer.classList.add('hidden'); kuesionerContainer.classList.remove('hidden'); renderCurrentQuestion(); });

        // --- Fungsi Logika Tes ---
        function renderCurrentQuestion() {
            const question = questions[currentQuestionIndex];
            questionDisplay.innerHTML = `<p class="text-xl font-medium mb-6 text-center">${question.text}</p><div class="flex flex-wrap justify-center gap-2 skala-container" role="radiogroup">${[1, 2, 3, 4, 5].map(val => `<input type="radio" name="q_answer" value="${val}" id="q_answer_${val}" class="sr-only"><label for="q_answer_${val}" class="w-14 h-14 sm:w-16 sm:h-16 flex items-center justify-center text-xl font-bold border-2 border-slate-300 rounded-full cursor-pointer transition-all duration-200 hover:bg-slate-100 hover:scale-105">${val}</label>`).join('')}</div>`;
            questionDisplay.classList.remove('fade-in'); void questionDisplay.offsetWidth; questionDisplay.classList.add('fade-in');
            if (userAnswers[currentQuestionIndex] !== null) { const savedAnswer = questionDisplay.querySelector(`input[value="${userAnswers[currentQuestionIndex]}"]`); if (savedAnswer) { savedAnswer.checked = true; } }
            updateNavigation(); updateProgress();
        }
        
        function updateNavigation() {
            prevBtn.disabled = currentQuestionIndex === 0;
            if (currentQuestionIndex === questions.length - 1) { nextBtn.textContent = 'Selesai & Lihat Hasil'; nextBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700'); nextBtn.classList.add('bg-green-600', 'hover:bg-green-700'); } else { nextBtn.textContent = 'Berikutnya'; nextBtn.classList.remove('bg-green-600', 'hover:bg-green-700'); nextBtn.classList.add('bg-blue-600', 'hover:bg-blue-700'); }
        }
        
        function updateProgress() {
            const answeredCount = userAnswers.filter(answer => answer !== null).length;
            const percentage = (answeredCount / questions.length) * 100;
            progressBar.style.width = `${percentage}%`;
            progressText.textContent = `Pertanyaan ${currentQuestionIndex + 1} dari ${questions.length}`;
        }
        
        function handleNextButtonClick() {
            // Simpan jawaban sebelum melakukan apa pun
            const selectedAnswer = questionDisplay.querySelector('input[name="q_answer"]:checked');
            if (!selectedAnswer) { 
                errorMessage.textContent = 'Silakan pilih jawaban Anda terlebih dahulu.'; 
                return; 
            }
            errorMessage.textContent = '';
            userAnswers[currentQuestionIndex] = parseInt(selectedAnswer.value);
            
            // Periksa apakah ini pertanyaan terakhir atau bukan
            if (currentQuestionIndex < questions.length - 1) {
                // Jika bukan terakhir, langsung ke pertanyaan berikutnya
                currentQuestionIndex++;
                renderCurrentQuestion();
            } else {
                // Jika ini adalah klik terakhir ("Selesai & Lihat Hasil")
                handleSubmit();
            }
        }
        
        // PERBAIKAN: Fungsi terpisah untuk submit hasil akhir
        function handleSubmit() {
            // Beri feedback visual bahwa proses sedang berjalan
            nextBtn.disabled = true;
            nextBtn.textContent = 'Memproses...';

            const missingQuestions = [];
            userAnswers.forEach((answer, index) => {
                if (answer === null) {
                    missingQuestions.push(index + 1);
                }
            });
            
            if (missingQuestions.length > 0) {
                console.error("Pertanyaan yang terlewat (nomor):", missingQuestions.join(', '));
                alert(`TES BELUM LENGKAP!\n\nAnda belum menjawab pertanyaan nomor: ${missingQuestions.join(', ')}.\n\nSilakan gunakan tombol 'Sebelumnya' untuk kembali dan melengkapi jawaban Anda.`);
                
                // Kembalikan tombol ke keadaan semula jika ada error
                nextBtn.disabled = false;
                nextBtn.textContent = 'Selesai & Lihat Hasil';
            } else {
                errorMessage.textContent = '';
                calculateAndShowResults();
            }
        }

        function goToPrevQuestion() { 
            // Simpan jawaban saat ini jika ada, sebelum kembali
            const selectedAnswer = questionDisplay.querySelector('input[name="q_answer"]:checked');
            if (selectedAnswer) {
                userAnswers[currentQuestionIndex] = parseInt(selectedAnswer.value);
            }
            
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--; 
                renderCurrentQuestion(); 
            }
        }

        async function calculateAndShowResults() {
            const scores = { O: 0, C: 0, E: 0, A: 0, N: 0 };
            questions.forEach((q, index) => { let score = userAnswers[index]; if (q.reverse) { score = 6 - score; } scores[q.trait] += score; });
            
            try {
                const resultsCollection = collection(db, 'artifacts', appId, 'public', 'data', 'ocean_results');
                await addDoc(resultsCollection, { name: candidateName, scores: scores, timestamp: Timestamp.now() });
                console.log("Hasil berhasil disimpan ke Firestore.");
            } catch (error) {
                console.error("Gagal menyimpan hasil: ", error);
                alert("Terjadi kesalahan saat menyimpan hasil Anda. Namun, Anda masih bisa melihat hasilnya di layar ini.");
            }
            
            kuesionerContainer.classList.add('hidden');
            hasilContainer.classList.remove('hidden');
            
            const penjelasanContainer = document.getElementById('penjelasan-hasil');
            penjelasanContainer.innerHTML = ''; 

            const traitOrder = ['O', 'C', 'E', 'A', 'N'];
            traitOrder.forEach(trait => {
                const score = scores[trait]; const isHigh = score > 30; const desc = descriptions[trait];
                const card = document.createElement('div'); card.className = 'bg-slate-50 p-5 rounded-lg border border-slate-200'; card.innerHTML = `<h3 class="text-xl font-bold mb-2 text-blue-700">${desc.name}</h3><p class="text-3xl font-bold mb-3">${score}<span class="text-base font-normal text-slate-500">/50</span></p><p class="text-sm text-slate-700">${isHigh ? desc.high : desc.low}</p>`;
                penjelasanContainer.appendChild(card);
            });
            
            const ctx = document.getElementById('grafik-hasil').getContext('2d');
            new Chart(ctx, { type: 'radar', data: { labels: traitOrder.map(t => descriptions[t].name.split(' ')[0]), datasets: [{ label: 'Skor Anda', data: traitOrder.map(t => scores[t]), backgroundColor: 'rgba(59, 130, 246, 0.2)', borderColor: 'rgba(59, 130, 246, 1)', borderWidth: 2 }] }, options: { scales: { r: { beginAtZero: true, max: 50 } }, plugins: { legend: { display: false } } } });
            window.scrollTo(0, 0);
        }

        async function fetchAndDisplayAllResults() {
            const container = document.getElementById('results-table-container');
            container.innerHTML = '<p class="text-center text-slate-500">Memuat hasil...</p>';
            
            try {
                const resultsCollection = collection(db, 'artifacts', appId, 'public', 'data', 'ocean_results');
                const q = query(resultsCollection, orderBy("timestamp", "desc"));
                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) { container.innerHTML = '<p class="text-center text-slate-500">Belum ada hasil tes yang masuk.</p>'; return; }

                let tableHTML = `<table class="w-full text-sm text-left text-slate-500"><thead class="text-xs text-slate-700 uppercase bg-slate-100"><tr><th scope="col" class="px-6 py-3">Nama Kandidat</th><th scope="col" class="px-6 py-3 text-center">O</th><th scope="col" class="px-6 py-3 text-center">C</th><th scope="col" class="px-6 py-3 text-center">E</th><th scope="col" class="px-6 py-3 text-center">A</th><th scope="col" class="px-6 py-3 text-center">N</th><th scope="col" class="px-6 py-3">Waktu Tes</th></tr></thead><tbody>`;
                
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    tableHTML += `<tr class="bg-white border-b"><th scope="row" class="px-6 py-4 font-medium text-slate-900 whitespace-nowrap">${data.name}</th><td class="px-6 py-4 text-center">${data.scores.O}</td><td class="px-6 py-4 text-center">${data.scores.C}</td><td class="px-6 py-4 text-center">${data.scores.E}</td><td class="px-6 py-4 text-center">${data.scores.A}</td><td class="px-6 py-4 text-center">${data.scores.N}</td><td class="px-6 py-4 text-slate-600">${data.timestamp.toDate().toLocaleString('id-ID')}</td></tr>`;
                });

                tableHTML += '</tbody></table>';
                container.innerHTML = tableHTML;

            } catch (error) {
                console.error("Gagal mengambil data hasil: ", error);
                container.innerHTML = '<p class="text-center text-red-500">Gagal memuat hasil. Silakan periksa konsol untuk detail error.</p>';
            }
        }

        nextBtn.addEventListener('click', handleNextButtonClick); // Menggunakan fungsi handler baru
        prevBtn.addEventListener('click', goToPrevQuestion);

    </script>
</body>
</html>